<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/advanced-react-pattern/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/advanced-react-pattern/_next/static/chunks/webpack-79bfb6a7cdfac8de.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/framework-0ba0ddd33199226d.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/main-c82185d11959f538.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/pages/_app-ed76948c8b6fd9ce.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/150-0c571cb3fec66944.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/76-c5434b33b61d8dfe.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/pages/FetchHook-d28afbc8cba25479.js" defer=""></script><script src="/advanced-react-pattern/_next/static/hBIzqNdJZbdlav5wuMKbn/_buildManifest.js" defer=""></script><script src="/advanced-react-pattern/_next/static/hBIzqNdJZbdlav5wuMKbn/_ssgManifest.js" defer=""></script><script src="/advanced-react-pattern/_next/static/hBIzqNdJZbdlav5wuMKbn/_middlewareManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.QPxGF{margin-right:auto;margin-left:auto;padding-right:15px;padding-left:15px;width:100%;max-width:992px;}/*!sc*/
@media (min-width:576px){.QPxGF{width:99vw;}}/*!sc*/
@media (min-width:768px){.QPxGF{width:90vw;}}/*!sc*/
@media (min-width:992px){.QPxGF{width:70vw;}}/*!sc*/
@media (min-width:1200px){.QPxGF{width:40vw;}}/*!sc*/
data-styled.g1[id="Container__Styled-sc-zkefve-0"]{content:"QPxGF,"}/*!sc*/
.fHFsLe{white-space:nowrap;line-height:1.5;}/*!sc*/
data-styled.g2[id="Li__Styled-sc-2pbekf-0"]{content:"fHFsLe,"}/*!sc*/
.QgnfO figure{margin:0;}/*!sc*/
.QgnfO .hljs{background:#f6f6f6;color:black;border-radius:0.5rem;padding:2rem 1rem 2rem 2rem;font-size:0.95rem;line-height:1.25;}/*!sc*/
.QgnfO .xml .hljs-meta{color:#c0c0c0;}/*!sc*/
.QgnfO .hljs-comment,.QgnfO .hljs-quote{color:#007400;}/*!sc*/
.QgnfO .hljs-tag,.QgnfO .hljs-attribute,.QgnfO .hljs-keyword,.QgnfO .hljs-selector-tag,.QgnfO .hljs-literal,.QgnfO .hljs-name{color:#aa0d91;}/*!sc*/
.QgnfO .hljs-variable,.QgnfO .hljs-template-variable{color:#3f6e74;}/*!sc*/
.QgnfO .hljs-code,.QgnfO .hljs-string,.QgnfO .hljs-meta .hljs-string{color:#c41a16;}/*!sc*/
.QgnfO .hljs-regexp,.QgnfO .hljs-link{color:#0e0eff;}/*!sc*/
.QgnfO .hljs-title,.QgnfO .hljs-symbol,.QgnfO .hljs-bullet,.QgnfO .hljs-number{color:#1c00cf;}/*!sc*/
.QgnfO .hljs-section,.QgnfO .hljs-meta{color:#643820;}/*!sc*/
.QgnfO .hljs-title.class_,.QgnfO .hljs-class .hljs-title,.QgnfO .hljs-type,.QgnfO .hljs-built_in,.QgnfO .hljs-params{color:#5c2699;}/*!sc*/
.QgnfO .hljs-attr{color:#836c28;}/*!sc*/
.QgnfO .hljs-subst{color:#000;}/*!sc*/
.QgnfO .hljs-formula{background-color:#eee;font-style:italic;}/*!sc*/
.QgnfO .hljs-addition{background-color:#baeeba;}/*!sc*/
.QgnfO .hljs-deletion{background-color:#ffc8bd;}/*!sc*/
.QgnfO .hljs-selector-id,.QgnfO .hljs-selector-class{color:#9b703f;}/*!sc*/
.QgnfO .hljs-doctag,.QgnfO .hljs-strong{font-weight:bold;}/*!sc*/
.QgnfO .hljs-emphasis{font-style:italic;}/*!sc*/
data-styled.g3[id="Code__CodeTheme-sc-1i7zmjv-0"]{content:"QgnfO,"}/*!sc*/
.fwqmoU{margin-top:44px;margin-bottom:44px;overflow-x:scroll;}/*!sc*/
data-styled.g4[id="Code__StyledPre-sc-1i7zmjv-1"]{content:"fwqmoU,"}/*!sc*/
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;}/*!sc*/
body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;margin:0;padding:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}/*!sc*/
data-styled.g5[id="sc-global-jbFqTx1"]{content:"sc-global-jbFqTx1,"}/*!sc*/
.fEHXxv{margin-bottom:1.4211em;font-size:1.125rem;color:#1a1a1a;line-height:1.4211;font-weight:400;-webkit-letter-spacing:0.012em;-moz-letter-spacing:0.012em;-ms-letter-spacing:0.012em;letter-spacing:0.012em;font-family:"SF Pro Display","SF Pro Icons","Helvetica Neue","Helvetica","Arial",sans-serif;}/*!sc*/
data-styled.g6[id="P__StyledP-sc-f4vqmk-0"]{content:"fEHXxv,"}/*!sc*/
.ckUnzH{font-size:48px;line-height:1.08349;font-weight:700;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;font-family:"SF Pro Display","SF Pro Icons","Helvetica Neue","Helvetica","Arial",sans-serif;}/*!sc*/
data-styled.g7[id="H1__StyledH1-sc-rl2x2k-0"]{content:"ckUnzH,"}/*!sc*/
.bVwmUH{font-size:12px;line-height:1.33337;font-weight:700;text-transform:uppercase;}/*!sc*/
data-styled.g8[id="Eyebrow-sc-nknczf-0"]{content:"bVwmUH,"}/*!sc*/
</style></head><body><div id="__next"><div><div class="Container__Styled-sc-zkefve-0 QPxGF"><div><div><div itemscope="" itemType="https://schema.org/BlogPosting"><div itemProp="headline"><h1 class="H1__StyledH1-sc-rl2x2k-0 ckUnzH">The useFetch hook</h1></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><div><span class="Eyebrow-sc-nknczf-0 bVwmUH">Author: </span><span itemProp="name"><a href="https://github.com/rilexus">Stanislav Panchenko</a></span></div><div><meta itemProp="url" content="https://github.com/rilexus"/></div></div><div itemProp="datePublished"><span class="Eyebrow-sc-nknczf-0 bVwmUH">Published</span>: <!-- -->August 19, 2022</div><div itemProp="articleBody" style="margin-bottom:2rem"><div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">Fetching data from an endpoint on mount is a long tradition in react. Most of the time it looks like this:</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const Component = () =&gt; {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() =&gt; {
    setLoading(true);
    fetch(&quot;api/data&quot;, {})
      .then((data) =&gt; {
        setData(data);
        setLoading(false);
      })
      .catch((e) =&gt; {
        setError(e);
      });
  }, []);

  return &lt;div&gt;{!loading ? &lt;div&gt;{data}&lt;/div&gt; : null}&lt;/div&gt;;
};</pre></div></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">We handle 3 states a once for one fetch operation: one for the data, one for the loading state and one for the error. Here we postpone rendering as long as the loading state is true.</p><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">This pattern is often times repeated though out the application again and again. That should not be the case, especially because this pattern is very easy to abstract:</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const Component = () =&gt; {
  const { data, loading, error } = useFetch(async () =&gt; fetch(&quot;api/data&quot;, {}));

  return &lt;div&gt;{!loading ? &lt;div&gt;{data}&lt;/div&gt; : null}&lt;/div&gt;;
};</pre></div></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">Look how tiny and cute this is!</p><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">The implementation of the fetch hook is very simple:</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const useFetch = (fetcher) =&gt; {
  const mounted = useRef(true);

  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() =&gt; {
    fetcher()
      .then((data) =&gt; {
        if (mounted.current) {
          setData(data);
          setLoading(false);
        }
      })
      .catch((e) =&gt; {
        if (mounted.current) {
          setError(e);
          setLoading(false);
        }
      });

    return () =&gt; {
      mounted.current = false;
    };
  }, []);

  return { data, loading, error };
};</pre></div></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">With this we do not need to repeat ourself. All the necessary logic is hidden in the hook. We do not need to think about handling multiple states ourself.</p><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">We can go one step further and pass more options to the hook. For example, we would like to decide, if we fetch on mount of not. And if not, we would like to trigger the fetch call ourself.</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const useFetch = ({ get, onMount = true }) =&gt; {
  const mounted = useRef(true);

  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() =&gt; {
    if (!onMount) return;
    get()
      .then((data) =&gt; {
        if (mounted.current) {
          setData(data);
          setLoading(false);
        }
      })
      .catch((e) =&gt; {
        if (mounted.current) {
          setError(e);
          setLoading(false);
        }
      });

    return () =&gt; {
      mounted.current = false;
    };
  }, []);

  const refetch = useCallback(
    (...args) =&gt; {
      setLoading(true);
      get(...args)
        .then((data) =&gt; {
          if (mounted.current) {
            setLoading(false);
            setData(data);
          }
        })
        .catch((e) =&gt; {
          if (mounted.current) {
            setLoading(false);
            setError(e);
          }
        });
    },
    [get]
  );

  return { data, loading, error, refetch };
};</pre></div></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">The main change is the refetch function. We pass all arguments from the refetch to the get function. Effectively we predefine the API getter and invoke it later in time:</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const Component = () =&gt; {
  const { data, loading, error, refetch } = useFetch({
    get: async ({ id }) =&gt; fetch(`api/users?id=${id}`, {}),
    onMount: false,
  });

  return (
    &lt;div&gt;
      {!loading ? (
        &lt;div&gt;
          &lt;button
            onClick={() =&gt; {
              refetch({ id: 1 });
            }}
          &gt;
            get user
          &lt;/button&gt;
        &lt;/div&gt;
      ) : null}
    &lt;/div&gt;
  );
};</pre></div></div><img src="https://media.giphy.com/media/WrJ8x0niiblWEoo7hE/giphy.gif" alt=""/></div></div><div style="padding:3rem 0 1rem 0"><meta itemProp="dateCreated" content="August 19, 2022"/><meta itemProp="inLanguage" content="English"/><div itemProp="publisher" itemscope="" itemType="https://schema.org/Organization">Published by:<div>Email: <span itemProp="email">email@stanislavpanchenko.de</span></div><div itemProp="funder" itemscope="" itemType="https://schema.org/Person"><div>Name: <span itemProp="name">Stanislav Panchenko</span></div></div></div><div itemProp="isPartOf" itemscope="" itemType="https://schema.org/CreativeWork"><meta itemProp="url" content="https://rilexus.github.io/advanced-react-pattern/"/></div><div itemProp="copyrightHolder" itemscope="" itemType="https://schema.org/Person">Copyright: <span itemProp="name">Stanislav Panchenko</span></div></div></div></div></div><div style="height:100vh;background:rgba(255,255,255,0.76);top:0;backdrop-filter:blur(10px);left:0;box-shadow:none;padding-left:2rem;transition:transform 200ms;transform:translate(-300px);width:300px;position:fixed"><button style="width:2rem;height:2rem;border-radius:3rem;border:1px solid #d8d8d8;display:flex;align-items:center;justify-content:center;cursor:pointer;position:absolute;top:20px;right:-1rem;transition:transform 200ms;transform:rotate(180deg)"><svg stroke="currentColor" fill="currentColor" height="1rem" width="1rem" stroke-width="0" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M217.9 256L345 129c9.4-9.4 9.4-24.6 0-33.9-9.4-9.4-24.6-9.3-34 0L167 239c-9.1 9.1-9.3 23.7-.7 33.1L310.9 417c4.7 4.7 10.9 7 17 7s12.3-2.3 17-7c9.4-9.4 9.4-24.6 0-33.9L217.9 256z"></path></svg></button><nav><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern">Home</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><h4>Utils</h4><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/Prefetch">Prefetched State</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/StateSubscription">State Subscription</a></li></ul></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><h4>Components</h4><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/suspense">Suspense</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/CompoundToggle">Compound Components</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/StateReducer">State Reducer</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/PropCollection">Props Collection</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/RenderPropsToggle">Render Props</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/Factory">Factory</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/ControlProps">Control Props</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/Decorator">Decorator</a></li></ul></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><h4>Hooks</h4><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/ReducerHook">Reducer Hook</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/UndoState">Undo State</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/ThunkReducer">Thunk Reducer</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/FetchHook">Fetch Hook</a></li></ul></li></ul></nav></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/FetchHook","query":{},"buildId":"hBIzqNdJZbdlav5wuMKbn","assetPrefix":"/advanced-react-pattern","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>