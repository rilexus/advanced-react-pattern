(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[430],{27672:function(n,t,e){"use strict";var r=e(13922),s=e(15234),i=e(9668),a=e(89100),c=e(68556),o=(e(67294),e(85893));t.Z=function(n){var t=n.author,e=t.url,u=t.name,l=n.dataPublished,d=n.title,h=n.content,f=n.dataCreated,b=n.inLanguage,p=n.partfOf,g=n.copyRight,m=g.name,v=g.email,y=n.organisation,j=y.email,x=y.name,S=y.funder.name;return(0,o.jsxs)("div",{children:[(0,o.jsx)(r.Z,{space:"4rem"}),(0,o.jsx)(s.Z,{children:(0,o.jsx)("main",{children:(0,o.jsx)("article",{children:(0,o.jsxs)(i.Z,{children:[(0,o.jsxs)(a.Z,{color:"#6e6e73",children:[(0,o.jsx)(i.Z.Author,{name:u,url:e}),(0,o.jsx)(i.Z.DatePublished,{children:l})]}),(0,o.jsx)(i.Z.Headline,{children:(0,o.jsx)(c.Z,{children:d})}),(0,o.jsx)(i.Z.Body,{style:{marginBottom:"2rem"},children:h}),(0,o.jsxs)("div",{style:{padding:"3rem 0 1rem 0"},children:[(0,o.jsx)(i.Z.DateCreated,{children:f}),(0,o.jsx)(i.Z.Language,{children:b}),(0,o.jsx)(i.Z.Organization,{funder:{name:S},name:x,email:j}),(0,o.jsx)(i.Z.PartOf,{url:p}),(0,o.jsx)(i.Z.CopyRight,{name:m,email:v})]})]})})})})]})}},59018:function(n,t,e){"use strict";e.r(t),e.d(t,{default:function(){return y}});var r=e(45959),s=e(63553),i=e(37247),a=e(92777),c=e(82262),o=e(59499),u=e(67294),l=e(43236),d=(e(4944),e(94484),e(52528),e(27672)),h=e(85893),f=function(n){var t=n.title,e=n.inLanguage,r=n.dateCreated,s=n.datePublished,i=n.content;return(0,h.jsx)(d.Z,{title:t,copyRight:{name:"Stanislav Panchenko",email:"email@stanislavpanchenko.de"},content:i,inLanguage:e,partfOf:"https://rilexus.github.io/advanced-react-pattern/",dataCreated:r,dataPublished:s,organisation:{email:"email@stanislavpanchenko.de",name:"Stanislav Panchenko",funder:{name:"Stanislav Panchenko"}},author:{url:"https://github.com/rilexus",name:"Stanislav Panchenko"}})},b=e(84663);function p(n){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(n){return!1}}();return function(){var e,r=(0,i.Z)(n);if(t){var a=(0,i.Z)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return(0,s.Z)(this,e)}}var g=function(){function n(t){(0,a.Z)(this,n),(0,o.Z)(this,"subscribers",[]),this.state=t}return(0,c.Z)(n,[{key:"subscribe",value:function(n){"function"===typeof n&&this.subscribers.push(n)}},{key:"unsubscribe",value:function(n){this.subscribers=this.subscribers.filter((function(t){return t!==n}))}},{key:"notify",value:function(){var n=this;this.subscribers.forEach((function(t){t(n.state)}))}},{key:"setState",value:function(n){this.state=n,this.notify()}},{key:"getState",value:function(){return this.state}}]),n}(),m=new(function(n){(0,r.Z)(e,n);var t=p(e);function e(){return(0,a.Z)(this,e),t.call(this,0)}return(0,c.Z)(e,[{key:"add",value:function(n){this.setState(this.getState()+n)}}]),e}(g)),v=function(){var n=m.getState(),t=(0,u.useState)(!0)[1];return(0,u.useEffect)((function(){var n=function(){t((function(n){return!n}))};return m.subscribe(n),function(){m.unsubscribe(n)}}),[]),(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{children:n}),(0,h.jsx)("div",{children:(0,h.jsx)("button",{onClick:function(){return m.add(1)},children:"Add"})})]})},y=function(){return(0,h.jsx)("div",{children:(0,h.jsx)(f,{title:"State Subscription",inLanguage:"English",dateCreated:"August 10, 2022",datePublished:"August 24, 2022",content:(0,h.jsxs)("div",{children:[(0,h.jsx)(b.P,{children:"The \u201cuseState\u201c and \u201cuseReducer\u201c are not the only means to hold state in react. You can offload the state and the corresponding logic to other entities in the application."}),(0,h.jsx)(b.P,{children:"You can see the most obvious example of this right below."}),(0,h.jsx)(l.E,{highlight:[{start:1,end:14}],children:"let state = 0;\n\nconst setState = (newState, callback) => {\n  state = newState;\n  callback(state);\n};\n\nconst getState = () => {\n  return state;\n};\n\nconst increment = (callback) => {\n  setState(getState() + 1, callback);\n};\n\nconst Component = () => {\n  const [, setFlag] = useState(false);\n\n  const rerender = () => {\n    setFlag((s) => !s);\n  };\n\n  return (\n    <div>\n      {getState()}\n      <button\n        onClick={() => {\n          increment(() => {\n            rerender();\n          });\n        }}\n      >\n        increment\n      </button>\n    </div>\n  );\n};"}),(0,h.jsx)(b.P,{children:"Simply setting variables which are outside the react component, will not trigger a re-render. We need to notify components, so they can rerender. You need to pay attention to the \u201crerender\u201c function and the passed callback to the \u201cincrement\u201c function. As soon as we set a new state, we call the callback and flip a state."}),(0,h.jsx)(l.E,{highlight:[{start:17,end:17},{start:20,end:20},{start:29,end:29}],children:"let state = 0;\n\nconst setState = (newState, callback) => {\n  state = newState;\n  callback(state);\n};\n\nconst getState = () => {\n  return state;\n};\n\nconst increment = (callback) => {\n  setState(getState() + 1, callback);\n};\n\nconst Component = () => {\n  const [, setFlag] = useState(false);\n\n  const rerender = () => {\n    setFlag((s) => !s);\n  };\n\n  return (\n    <div>\n      {getState()}\n      <button\n        onClick={() => {\n          increment(() => {\n            rerender();\n          });\n        }}\n      >\n        increment\n      </button>\n    </div>\n  );\n};"}),(0,h.jsx)(b.P,{children:"This look ugly. We can improve on it."}),(0,h.jsx)(l.E,{highlight:[{start:16,end:31},{start:34,end:34}],children:"let state = 0;\n\nconst setState = (newState, callback) => {\n  state = newState;\n  callback(state);\n};\n\nconst getState = () => {\n  return state;\n};\n\nconst increment = (callback) => {\n  setState(getState() + 1, callback);\n};\n\nconst useCounter = () => {\n  const [, setFlag] = useState(false);\n\n  const rerender = () => {\n    setFlag((s) => !s);\n  };\n\n  return [\n    getState(),\n    () => {\n      increment(() => {\n        rerender();\n      });\n    },\n  ];\n};\n\nconst C = () => {\n  const [value, increment] = useCounter();\n  return (\n    <div>\n      {value}\n      <button\n        onClick={() => {\n          increment();\n        }}\n      >\n        increment\n      </button>\n    </div>\n  );\n};"}),(0,h.jsx)(b.P,{children:"All I did, was wrapping the re-rendering part in to a hook. Now from the \u201cComponent\u201c perspective, it does not know how the state and the increment logic is implemented. The \u201cuseCounter\u201c hook could even talk with an endpoint, if needed. The \u201cComponent\u201c is totally unaware about anything."}),(0,h.jsx)(b.P,{children:"A more sophisticated implementation of the same behavior is below."}),(0,h.jsx)(l.E,{children:'class State {\n  subscribers = [];\n  constructor(state) {\n    this.state = state;\n  }\n\n  subscribe(subscriber) {\n    if (typeof subscriber !== "function") return;\n    this.subscribers.push(subscriber);\n  }\n\n  unsubscribe(subscriber) {\n    this.subscribers = this.subscribers.filter((s) => s !== subscriber);\n  }\n\n  notify() {\n    this.subscribers.forEach((subscriber) => {\n      subscriber(this.state);\n    });\n  }\n\n  setState(newState) {\n    this.state = newState;\n    this.notify();\n  }\n\n  getState() {\n    return this.state;\n  }\n}\n\n\n\nclass Counter extends State {\n  constructor() {\n    super(0);\n  }\n\n  increment(value) {\n    this.setState(this.getState() + 1);\n  }\n}'}),(0,h.jsx)(l.E,{children:" const counter = new Counter();\n\n const useCounter = () => {\n  const count = counter.getState();\n  const [, setFlag] = useState(true);\n\n  useEffect(() => {\n    const handler = () => {\n      setFlag((toggle) => !toggle);\n    };\n    counter.subscribe(handler);\n    return () => {\n      counter.unsubscribe(handler);\n    };\n  }, []);\n  \n  return [count, controller.increment];\n}"}),(0,h.jsx)(l.E,{children:"const Component = () => {\n  const [count, increment] = useCounter();\n  \n  return (\n    <div>\n      <div>{count}</div>\n      <div>\n        <button onClick={() => increment()}>Add</button>\n      </div>\n    </div>\n  );\n};"}),(0,h.jsx)(b.P,{children:"This is huge! The implication of this is that we can synchronize any class with react components. We can move all the domain logic out of component. This way we handle react as it was intended: a UI library."}),(0,h.jsxs)("div",{children:[(0,h.jsx)("b",{children:"Try it out"}),(0,h.jsx)(v,{})]})]})})})}},89100:function(n,t,e){"use strict";e(67294);var r=e(85893);t.Z=function(n){var t=n.children,e=n.color;return(0,r.jsx)("div",{style:{color:e},children:t})}},13922:function(n,t,e){"use strict";e(67294);var r=e(85893);t.Z=function(n){var t=n.space,e=void 0===t?"0px":t;return(0,r.jsx)("div",{style:{paddingTop:e}})}},27633:function(n,t,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/StateSubscription",function(){return e(59018)}])},10748:function(n,t,e){"use strict";function r(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}e.d(t,{Z:function(){return r}})},92777:function(n,t,e){"use strict";function r(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}e.d(t,{Z:function(){return r}})},82262:function(n,t,e){"use strict";function r(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function s(n,t,e){return t&&r(n.prototype,t),e&&r(n,e),n}e.d(t,{Z:function(){return s}})},37247:function(n,t,e){"use strict";function r(n){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},r(n)}e.d(t,{Z:function(){return r}})},45959:function(n,t,e){"use strict";function r(n,t){return r=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},r(n,t)}function s(n,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t&&r(n,t)}e.d(t,{Z:function(){return s}})},63553:function(n,t,e){"use strict";e.d(t,{Z:function(){return i}});var r=e(14027),s=e(10748);function i(n,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return(0,s.Z)(n)}}},function(n){n.O(0,[150,76,774,888,179],(function(){return t=27633,n(n.s=t);var t}));var t=n.O();_N_E=t}]);