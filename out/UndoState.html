<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/advanced-react-pattern/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/advanced-react-pattern/_next/static/chunks/webpack-79bfb6a7cdfac8de.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/framework-0ba0ddd33199226d.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/main-c82185d11959f538.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/pages/_app-ddae3b7f261345fc.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/150-0c571cb3fec66944.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/76-9cbc19c2fc8c3153.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/pages/UndoState-8e97b51bd1a999a2.js" defer=""></script><script src="/advanced-react-pattern/_next/static/JVafFwdFuY538MjcI8tiK/_buildManifest.js" defer=""></script><script src="/advanced-react-pattern/_next/static/JVafFwdFuY538MjcI8tiK/_ssgManifest.js" defer=""></script><script src="/advanced-react-pattern/_next/static/JVafFwdFuY538MjcI8tiK/_middlewareManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.fEHXxv{margin-bottom:1.4211em;font-size:1.125rem;color:#1a1a1a;line-height:1.4211;font-weight:400;-webkit-letter-spacing:0.012em;-moz-letter-spacing:0.012em;-ms-letter-spacing:0.012em;letter-spacing:0.012em;font-family:"SF Pro Display","SF Pro Icons","Helvetica Neue","Helvetica","Arial",sans-serif;}/*!sc*/
data-styled.g1[id="P__StyledP-sc-f4vqmk-0"]{content:"fEHXxv,"}/*!sc*/
.ckUnzH{font-size:48px;line-height:1.08349;font-weight:700;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;font-family:"SF Pro Display","SF Pro Icons","Helvetica Neue","Helvetica","Arial",sans-serif;}/*!sc*/
data-styled.g2[id="H1__StyledH1-sc-rl2x2k-0"]{content:"ckUnzH,"}/*!sc*/
.fnJOng{white-space:nowrap;line-height:1.5;padding-bottom:0.4rem;}/*!sc*/
data-styled.g3[id="Li__Styled-sc-2pbekf-0"]{content:"fnJOng,"}/*!sc*/
.hWeMkM{cursor:pointer;font-size:1.1rem;-webkit-text-decoration:none;text-decoration:none;color:blue;position:relative;}/*!sc*/
.hWeMkM:hover:after{-webkit-transform:translateX(1rem) translateY(-50%) rotate(-45deg);-ms-transform:translateX(1rem) translateY(-50%) rotate(-45deg);transform:translateX(1rem) translateY(-50%) rotate(-45deg);opacity:1;}/*!sc*/
.hWeMkM:after{content:" ";width:0.5rem;height:0.5rem;opacity:0;position:absolute;-webkit-transform:translateY(-50%) rotate(-45deg);-ms-transform:translateY(-50%) rotate(-45deg);transform:translateY(-50%) rotate(-45deg);-webkit-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-transition:-webkit-transform 200ms,opacity 200ms;-webkit-transition:transform 200ms,opacity 200ms;transition:transform 200ms,opacity 200ms;right:0;top:50%;border-right:2px solid blue;border-bottom:2px solid blue;}/*!sc*/
data-styled.g4[id="Link__StyledLink-sc-wozd19-0"]{content:"hWeMkM,"}/*!sc*/
.QPxGF{margin-right:auto;margin-left:auto;padding-right:15px;padding-left:15px;width:100%;max-width:992px;}/*!sc*/
@media (min-width:576px){.QPxGF{width:99vw;}}/*!sc*/
@media (min-width:768px){.QPxGF{width:90vw;}}/*!sc*/
@media (min-width:992px){.QPxGF{width:70vw;}}/*!sc*/
@media (min-width:1200px){.QPxGF{width:40vw;}}/*!sc*/
data-styled.g5[id="Container__Styled-sc-zkefve-0"]{content:"QPxGF,"}/*!sc*/
.gpnAYg{height:100vh;background:rgba(255,255,255,0.76);top:0;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);left:0;padding-left:2rem;-webkit-transition:-webkit-transform 200ms;-webkit-transition:transform 200ms;transition:transform 200ms;width:300px;position:fixed;}/*!sc*/
data-styled.g6[id="Layout__StyledSidebar-sc-1tqca63-0"]{content:"gpnAYg,"}/*!sc*/
.QgnfO figure{margin:0;}/*!sc*/
.QgnfO .hljs{background:#f6f6f6;color:black;border-radius:0.5rem;padding:2rem 1rem 2rem 2rem;font-size:0.95rem;line-height:1.25;}/*!sc*/
.QgnfO .xml .hljs-meta{color:#c0c0c0;}/*!sc*/
.QgnfO .hljs-comment,.QgnfO .hljs-quote{color:#007400;}/*!sc*/
.QgnfO .hljs-tag,.QgnfO .hljs-attribute,.QgnfO .hljs-keyword,.QgnfO .hljs-selector-tag,.QgnfO .hljs-literal,.QgnfO .hljs-name{color:#aa0d91;}/*!sc*/
.QgnfO .hljs-variable,.QgnfO .hljs-template-variable{color:#3f6e74;}/*!sc*/
.QgnfO .hljs-code,.QgnfO .hljs-string,.QgnfO .hljs-meta .hljs-string{color:#c41a16;}/*!sc*/
.QgnfO .hljs-regexp,.QgnfO .hljs-link{color:#0e0eff;}/*!sc*/
.QgnfO .hljs-title,.QgnfO .hljs-symbol,.QgnfO .hljs-bullet,.QgnfO .hljs-number{color:#1c00cf;}/*!sc*/
.QgnfO .hljs-section,.QgnfO .hljs-meta{color:#643820;}/*!sc*/
.QgnfO .hljs-title.class_,.QgnfO .hljs-class .hljs-title,.QgnfO .hljs-type,.QgnfO .hljs-built_in,.QgnfO .hljs-params{color:#5c2699;}/*!sc*/
.QgnfO .hljs-attr{color:#836c28;}/*!sc*/
.QgnfO .hljs-subst{color:#000;}/*!sc*/
.QgnfO .hljs-formula{background-color:#eee;font-style:italic;}/*!sc*/
.QgnfO .hljs-addition{background-color:#baeeba;}/*!sc*/
.QgnfO .hljs-deletion{background-color:#ffc8bd;}/*!sc*/
.QgnfO .hljs-selector-id,.QgnfO .hljs-selector-class{color:#9b703f;}/*!sc*/
.QgnfO .hljs-doctag,.QgnfO .hljs-strong{font-weight:bold;}/*!sc*/
.QgnfO .hljs-emphasis{font-style:italic;}/*!sc*/
data-styled.g7[id="Code__CodeTheme-sc-1i7zmjv-0"]{content:"QgnfO,"}/*!sc*/
.fwqmoU{margin-top:44px;margin-bottom:44px;overflow-x:scroll;}/*!sc*/
data-styled.g8[id="Code__StyledPre-sc-1i7zmjv-1"]{content:"fwqmoU,"}/*!sc*/
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;}/*!sc*/
body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;margin:0;padding:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}/*!sc*/
data-styled.g9[id="sc-global-jbFqTx1"]{content:"sc-global-jbFqTx1,"}/*!sc*/
.bVwmUH{font-size:12px;line-height:1.33337;font-weight:700;text-transform:uppercase;}/*!sc*/
data-styled.g10[id="Eyebrow-sc-nknczf-0"]{content:"bVwmUH,"}/*!sc*/
</style></head><body><div id="__next"><div><div><div style="padding-top:4rem"></div><div><div class="Container__Styled-sc-zkefve-0 QPxGF"><div><main><article><div itemscope="" itemType="https://schema.org/BlogPosting"><div style="color:#6e6e73"><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><div><span class="Eyebrow-sc-nknczf-0 bVwmUH">Author: </span><span itemProp="name"><a href="https://github.com/rilexus">Stanislav Panchenko</a></span></div><div><meta itemProp="url" content="https://github.com/rilexus"/></div></div><div itemProp="datePublished"><span class="Eyebrow-sc-nknczf-0 bVwmUH">Published</span>: <!-- -->August 19, 2022</div></div><div itemProp="headline"><h1 class="H1__StyledH1-sc-rl2x2k-0 ckUnzH">Undo State</h1></div><div itemProp="articleBody" style="margin-bottom:2rem"><div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">Very common requirements in some what complex web applications is the “undo“ functionality. The user wants to undo the recent changes made in the application by pressing a button. You&#x27;ll know this behaviour when you press “command-z“ on mac or “strg-z“ on windows.</p><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">Example:</p><div><input placeholder="Type" type="text" value=""/><button disabled="">undo</button><button disabled="">redo</button><button>reset</button></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">Translating this requirements in to react would means setting the current state of a component to the previous states.</p><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">First we would need a component any state:</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const Component = () =&gt; {
  const [state, setState] = useState(&quot;&quot;);

  const handleChange = (e) =&gt; {
    setState(e.target.value);
  };

  return (
    &lt;div&gt;
      &lt;input type=&quot;text&quot; onChange={handleChange} value={state} /&gt;
    &lt;/div&gt;
  );
};</pre></div></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">When we set a new state, We would need to keep track of all the previous states:</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const Component = () =&gt; {
  const [state, setState] = useState({
    current: &quot;&quot;,
    past: [],
  });

  const handleChange = (e) =&gt; {
    setState((oldState) =&gt; {
      const { value } = e.target;
      return {
        ...oldState,
        past: [...oldState.past, oldState.current],
        current: value,
      };
    });
  };

  return (
    &lt;div&gt;
      &lt;input type=&quot;text&quot; onChange={handleChange} value={state.current} /&gt;
    &lt;/div&gt;
  );
};</pre></div></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">We save all the past states by adding the current value from the oldState to the past array and in the same time add the new value to the current.</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const Component = () =&gt; {
  const [state, setState] = useState({
    current: &quot;&quot;,
    past: [],
  });

  const handleChange = (e) =&gt; {
    setState((oldState) =&gt; {
      const { value } = e.target;
      return {
        ...oldState,
        past: [...oldState.past, oldState.current],
        current: value,
      };
    });
  };

  return (
    &lt;div&gt;
      &lt;input type=&quot;text&quot; onChange={handleChange} value={state.current} /&gt;
    &lt;/div&gt;
  );
};</pre></div></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">Now to undo the state change, we would need to take the last value from the past and save it in the current.</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const Component = () =&gt; {
  const [state, setState] = useState({
    current: &quot;&quot;,
    past: [],
  });

  const handleChange = (e) =&gt; {
    setState((oldState) =&gt; {
      const { value } = e.target;
      return {
        ...oldState,
        past: [...oldState.past, oldState.current],
        current: value,
      };
    });
  };

  const undo = () =&gt; {
    setState((oldState) =&gt; {
      if (oldState.past.length === 0) {
        return oldState;
      }
      const newPast = [...oldState.past];
      const pastValue = newPast.pop();

      return {
        ...oldState,
        past: newPast,
        current: pastValue,
      };
    });
  };

  return (
    &lt;div&gt;
      &lt;input type=&quot;text&quot; onChange={handleChange} value={state.current} /&gt;
      &lt;button onClick={undo}&gt;undo&lt;/button&gt;
    &lt;/div&gt;
  );
};</pre></div></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">First we make sure that we have values in the past. If we do not, we return the old state. If we have past states, we break the reference to the old past array, pop the last value and save everything to the new state.</p><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">While this works, we have an issue! The past array could grow until we run out of memory. We can prevent this from happening, by limiting the length of the past array. If the array grows beyond a certain limit, we remove values from the beginning of the array, effectively limiting the amount of past states.</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const Component = () =&gt; {
  const [state, setState] = useState({
    current: &quot;&quot;,
    past: [],
  });

  const handleChange = (e) =&gt; {
    setState((oldState) =&gt; {
      const { value } = e.target;

      let newPast = [];
      if (oldState.past.length &lt;= 10) {
        newPast = [...oldState.past];
      } else {
        const [, /*remove first: the oldest element*/ ...rest] = oldState.past;
        newPast = [...rest];
      }

      return {
        ...oldState,
        past: [...newPast, oldState.current],
        current: value,
      };
    });
  };

  const undo = () =&gt; {
    setState((oldState) =&gt; {
      if (oldState.past.length === 0) {
        return oldState;
      }
      const newPast = [...oldState.past];
      const pastValue = newPast.pop();

      return {
        ...oldState,
        past: newPast,
        current: pastValue,
      };
    });
  };
  
  return (
    &lt;div&gt;
      &lt;input type=&quot;text&quot; onChange={handleChange} value={state.current} /&gt;
      &lt;button onClick={undo}&gt;undo&lt;/button&gt;
    &lt;/div&gt;
  );
};</pre></div></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">If we have more then 10 past states, we remove the first (the oldest) state, preventing the past from growing.</p><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">The current implementation works. Lets make this code reusable and move it in to a dedicated hook.</p><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const useUndo = (initialState) =&gt; {
  const [state, _setState] = useState({
    current: initialState,
    past: [],
  });

  const undo = () =&gt; {
    _setState((oldState) =&gt; {
      if (oldState.past.length === 0) {
        return oldState;
      }
      const newPast = [...oldState.past];
      const pastValue = newPast.pop();

      return {
        ...oldState,
        past: newPast,
        current: pastValue,
      };
    });
  };

  const setState = (newState) =&gt; {
    _setState((oldState) =&gt; {
      const value =
        typeof newState === &quot;function&quot; ? newState(oldState) : newState;

      let newPast = [];
      if (oldState.past.length &lt;= 10) {
        newPast = [...oldState.past];
      } else {
        const [, /*remove first: the oldest element*/ ...rest] = oldState.past;
        newPast = [...rest];
      }

      return {
        ...oldState,
        past: [...newPast, oldState.current],
        current: value,
      };
    });
  };

  return [state.current, { setState, undo }];
};

const Component = () =&gt; {
  const [state, { setState, undo }] = useUndo(&quot;&quot;);

  const handleChange = (e) =&gt; {
    setState(e.target.value);
  };

  return (
    &lt;div&gt;
      &lt;input type=&quot;text&quot; onChange={handleChange} value={state} /&gt;
      &lt;button onClick={undo}&gt;undo&lt;/button&gt;
    &lt;/div&gt;
  );
};</pre></div></div><p class="P__StyledP-sc-f4vqmk-0 fEHXxv">It would be great to redo changes again. If the user undoes changes, goes in to the past, it would be great to go in to the future again to the last changes. I would encourage you to implement this feature yourself. If youre interested in seeing the end result, feel free to open the drop down.</p><details><summary style="cursor:pointer">End result</summary><div style="position:relative" class="Code__CodeTheme-sc-1i7zmjv-0 QgnfO"><div itemscope="" itemType="https://schema.org/SoftwareSourceCode"><div itemProp="audience" itemscope="" itemtype="https://schema.org/Audience"><meta itemProp="audienceType" content="programmers"/></div><meta itemProp="codeSampleType" content="code snippet"/><meta itemProp="codeRepository" content="https://github.com/rilexus/advanced-react-pattern"/><div itemProp="maintainer" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><div itemProp="author" itemscope="" itemType="https://schema.org/Person"><meta itemProp="image" content="https://avatars.githubusercontent.com/u/28537457?v=4"/><meta itemProp="sameAs" content="https://github.com/rilexus"/><meta itemProp="name" content="Stanislav Panchenko"/></div><meta itemProp="programmingLanguage" content="javascript"/><pre class="Code__StyledPre-sc-1i7zmjv-1 fwqmoU">const useUndo = (initialState) =&gt; {
  const [state, _setState] = useState({
    past: [],
    initialState: initialState,
    current: initialState,
    future: [],
  });

  const setState = (newState) =&gt; {
    _setState((oldState) =&gt; {
      let newPast = [];
      if (oldState.past.length &lt;= 10) {
        newPast = [...oldState.past, oldState.current];
      } else {
        const [, /*remove first: the oldest element*/ ...rest] = oldState.past;
        newPast = [...rest, oldState.current];
      }
      return {
        ...oldState,
        past: newPast,
        current:
          typeof newState === &quot;function&quot;
            ? newState(oldState.current)
            : newState,
        future: [],
      };
    });
  };

  const undo = () =&gt; {
    _setState((oldState) =&gt; {
      if (oldState.past.length === 0) {
        return oldState;
      }
      const newFuture = [...oldState.future, oldState.current];

      let newPast = [...oldState.past];
      const newState = newPast.pop();

      return {
        ...oldState,
        past: newPast,
        current: newState,
        future: newFuture,
      };
    });
  };

  const redo = () =&gt; {
    _setState((oldState) =&gt; {
      if (oldState.future.length === 0) {
        return oldState;
      }
      const newPast = [...oldState.past, oldState.current];

      const newFuture = [...oldState.future];
      const newState = newFuture.pop();

      return {
        ...oldState,
        past: newPast,
        current: newState,
        future: newFuture,
      };
    });
  };

  const reset = () =&gt; {
    _setState((oldState) =&gt; {
      return {
        ...oldState,
        past: [],
        current: state.initialState,
        future: [],
      };
    });
  };

  return [
    state.current,
    {
      setState,
      undo,
      redo,
      reset,
      canUndo: state.past.length &gt; 0,
      canRedo: state.future.length &gt; 0,
    },
  ];
};</pre></div></div></details></div></div><div style="padding:3rem 0 1rem 0"><meta itemProp="dateCreated" content="August 19, 2022"/><meta itemProp="inLanguage" content="English"/><div itemProp="publisher" itemscope="" itemType="https://schema.org/Organization">Published by:<div>Email: <span itemProp="email">email@stanislavpanchenko.de</span></div><div itemProp="funder" itemscope="" itemType="https://schema.org/Person"><div>Name: <span itemProp="name">Stanislav Panchenko</span></div></div></div><div itemProp="isPartOf" itemscope="" itemType="https://schema.org/CreativeWork"><meta itemProp="url" content="https://rilexus.github.io/advanced-react-pattern/"/></div><div itemProp="copyrightHolder" itemscope="" itemType="https://schema.org/Person">Copyright: <span itemProp="name">Stanislav Panchenko</span></div></div></div></article></main></div><div style="transform:translate(0px);box-shadow:0 0px 6px -1px rgb(0 0 0/0.1),
            0 0px 4px -2px rgb(0 0 0/0.1)" class="Layout__StyledSidebar-sc-1tqca63-0 gpnAYg"><button style="width:3rem;height:3rem;border-radius:3rem;border:1px solid #d8d8d8;display:flex;align-items:center;justify-content:center;cursor:pointer;position:absolute;top:20px;right:-1rem;transition:transform 200ms;transform:rotate(0deg)"><svg stroke="currentColor" fill="currentColor" height="1rem" width="1rem" stroke-width="0" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M217.9 256L345 129c9.4-9.4 9.4-24.6 0-33.9-9.4-9.4-24.6-9.3-34 0L167 239c-9.1 9.1-9.3 23.7-.7 33.1L310.9 417c4.7 4.7 10.9 7 17 7s12.3-2.3 17-7c9.4-9.4 9.4-24.6 0-33.9L217.9 256z"></path></svg></button><nav><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Home</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><h4>Utils</h4><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Prefetched State</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">State Subscription</a></li></ul></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><h4>Components</h4><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Suspense</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Compound Components</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">State Reducer</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Props Collection</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Render Props</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Factory</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Control Props</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Decorator</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Roles</a></li></ul></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><h4>Hooks</h4><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Reducer Hook</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Undo State</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Thunk Reducer</a></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">Fetch Hook</a></li></ul></li><li class="Li__Styled-sc-2pbekf-0 fnJOng"><h4>Patterns</h4><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fnJOng"><a class="Link__StyledLink-sc-wozd19-0 hWeMkM">MVC</a></li></ul></li></ul></nav></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/UndoState","query":{},"buildId":"JVafFwdFuY538MjcI8tiK","assetPrefix":"/advanced-react-pattern","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>