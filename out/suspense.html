<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/advanced-react-pattern/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/advanced-react-pattern/_next/static/chunks/webpack-3c61f17e0b13d5f0.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/framework-d51ece3d757c7ed2.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/main-e5ef016c3425ef5b.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/pages/_app-851a1d6d47233978.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/939-b1f31649ec1515fe.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/8782-4f6b4b88e8025081.js" defer=""></script><script src="/advanced-react-pattern/_next/static/chunks/pages/suspense-dc017b108c5650fb.js" defer=""></script><script src="/advanced-react-pattern/_next/static/uvQ_SCDlWddJhnxJtBvs3/_buildManifest.js" defer=""></script><script src="/advanced-react-pattern/_next/static/uvQ_SCDlWddJhnxJtBvs3/_ssgManifest.js" defer=""></script><script src="/advanced-react-pattern/_next/static/uvQ_SCDlWddJhnxJtBvs3/_middlewareManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;}/*!sc*/
body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;margin:0;padding:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}/*!sc*/
data-styled.g1[id="sc-global-jbFqTx1"]{content:"sc-global-jbFqTx1,"}/*!sc*/
.jfHJAM{margin-right:auto;margin-left:auto;padding-right:15px;padding-left:15px;width:100%;}/*!sc*/
@media screen and (max-width:575px){.jfHJAM{min-width:97vw;}}/*!sc*/
@media screen and (min-width:576px){.jfHJAM{max-width:1024px;}}/*!sc*/
data-styled.g5[id="Container__Styled-sc-zkefve-0"]{content:"jfHJAM,"}/*!sc*/
.fHFsLe{white-space:nowrap;line-height:1.5;}/*!sc*/
data-styled.g6[id="Li__Styled-sc-2pbekf-0"]{content:"fHFsLe,"}/*!sc*/
</style></head><body><div id="__next"><div class="Container__Styled-sc-zkefve-0 jfHJAM"><div style="display:flex;flex-direction:row"><div style="margin-right:1rem"><nav><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern">Home</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><h4>Utils</h4><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/Prefetch">Prefetched State</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/StateSubscription">State Subscription</a></li></ul></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><h4>Components</h4><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/suspense">Suspense</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/CompoundToggle">Compound Components</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/StateReducer">State Reducer</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/PropCollection">Props Collection</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/RenderPropsToggle">Render Props</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/Factory">Factory</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/ControlProps">Control Props</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/Decorator">Decorator</a></li></ul></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><h4>Hooks</h4><ul style="padding-left:1rem"><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/ThunkReducer">Thunk Reducer</a></li><li class="Li__Styled-sc-2pbekf-0 fHFsLe"><a href="/advanced-react-pattern/ReducerHook">Reducer Hook</a></li></ul></li></ul></nav></div><div><main><article><h1 style="font-size:2rem">Suspense</h1><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">Imagine you have a big Single Page Application with a sidebar like this one.</p><img width="500px" height="auto" src="/advanced-react-pattern/application_sidebar.png"/><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">Every button lead to a different page. I think the word &quot;view&quot; would be more appropriate, since its not a page. So every view is separate and independent from each other. It has its own purpose, its own code.</p><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">The user is interested in one view at a time and probably he is not interested in all the views of the application. Just think how often you visit the &quot;setting&quot; view of any application. I bet, you go there one time a month, if at all.</p><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">Now the thing is, if we as a developer do not pay attention, we would bundle the whole application to one single file. We will have one HTML file with a single div in it, where the application is going to be mounted.</p><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">This has an effect on the user experience. Just think about it! How much code does the application in total has? How many css lines, images, svg`s etc. We ship a lot of code and in our current case, we shit a lot of code at once.</p><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">Luckily we can improve this by utilising<!-- --> <a href="https://webpack.js.org/guides/lazy-loading/">webpack and the import function.</a></p><div style="margin:1rem 0;font-size:.9rem"><span style="font-size:inherit;font-family:inherit;background:#f3f3f3;color:#25282a;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px">const Backlog = await import(/* webpackChunkName: &quot;Backlog&quot; */ &quot;../Backlog&quot;);
const Board = await  import(/* webpackChunkName: &quot;Board&quot; */&quot;../Board&quot;);
const Reports = await import(/* webpackChunkName: &quot;Report&quot; */&quot;../Reports&quot;);
const Releases = await import(/* webpackChunkName: &quot;Releases&quot; */&quot;../Releases&quot;);</code></span></div><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">By doing this, webpack will split our application during the build time in small chunks. We will not get one single, heavy file, but multiple small once. One file for every component.</p><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">There is one thing left to do for us. That is to load this js files and to display those components only when we need them.</p><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">One obvious implementation for this could be this one.</p><div style="margin:1rem 0;font-size:.9rem"><span style="font-size:inherit;font-family:inherit;background:#f3f3f3;color:#25282a;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px">const Component = () =&gt; {
  const [, rerender] = useToggle();

  const backlogRef = useRef(null);

  const loadSidebar = async () =&gt; {
    //if backlog already loaded, do nothing
    if (backlogRef.current) return;

    const { default: Component } = await import(/* webpackChunkName: &quot;Backlog&quot; */ &quot;../Backlog&quot;);
    backlogRef.current = Component;

    rerender();
  };

  const Backlog = backlogRef.current;
  return (
    &lt;div&gt;
      &lt;div&gt;
        {/*sidebar*/}
        &lt;button onClick={loadSidebar}&gt;Backlog&lt;/button&gt;
      &lt;/div&gt;
      &lt;div&gt;
        {/*view*/}
        {Backlog &amp;&amp; &lt;Backlog /&gt;}
      &lt;/div&gt;
    &lt;/div&gt;
  );
};</code></span></div><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">We import the component on click, await the data, save it in a ref, rerender and were done.</p><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">That works great! Although it is manuel work and very verbose. For every view, we would need to write the same logic again and again. I personally would prefer not to think about the implementation at all. I would like to simply use it. I would like to have it more like: &quot;Here is a component. Please load and display it only as soon as I need it.&quot;</p><div style="margin:1rem 0;font-size:.9rem"><span style="font-size:inherit;font-family:inherit;background:#f3f3f3;color:#25282a;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px">const Backlog = (props) =&gt; {
  const [, rerender] = useToggle();
  const ref = useRef(() =&gt; null);
  
  useEffect(() =&gt; {
    import(&#x27;../Backlog&#x27;).then(({default: Component}) =&gt; {
      ref.current = Component;
      
      rerender()
    });
  }, []);
  
  const Component = ref.current;
  return &lt;Component {...props}/&gt;
}</code></span></div><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">This is much better! Every component is isolated. I can simply import it and use it. I personally would not prefer to write this for every component tho.</p><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">Lets move out the import state.</p><div style="margin:1rem 0;font-size:.9rem"><span style="font-size:inherit;font-family:inherit;background:#f3f3f3;color:#25282a;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px">const Lazy = ({ factory,...props }) =&gt; {
  const [, rerender] = useToggle();
  const ref = useRef(null);

  useEffect(() =&gt; {
    factory().then(({ default: Component }) =&gt; {
      ref.current = Component;

      rerender();
    });
  }, []);

  const Component = ref.current;
  return Component &amp;&amp; &lt;Component {...props} /&gt;;
};


const Backlog = (props) =&gt; {
  return &lt;Lazy factory={() =&gt; import(&#x27;../Backlog&#x27;)} {...props}/&gt;
}</code></span></div><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">Instead of hard code the import, we delegate the import call to a function. Now I do not need to reimplement the same logic multiple times. This solution is definitely better then the thing we have started with. Still to much work to. I do not like to worry about the props spreading, passing the import statement in to a component, wrap it in another component. Hustle! All this should be automated even further.</p><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">Something like this would be awesome!</p><div style="margin:1rem 0;font-size:.9rem"><span style="font-size:inherit;font-family:inherit;background:#f3f3f3;color:#25282a;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px">const BackLog = lazy(() =&gt; import(&quot;../Backlog&quot;));</code></span></div><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">I get a component back, the import is delegated and I should not worry about props.</p><div style="margin:1rem 0;font-size:.9rem"><span style="font-size:inherit;font-family:inherit;background:#f3f3f3;color:#25282a;border-radius:3px;display:flex;line-height:1.4285714285714286;overflow-x:auto;white-space:pre"><code style="font-size:inherit;font-family:inherit;line-height:1.6666666666666667;padding:8px">const lazy = (factory) =&gt; {
  // return a React component function
  return function LazyWrapper(props) {
    const [, rerender] = useToggle();
    const ref = useRef(() =&gt; null);
    useEffect(() =&gt; {
      // load JS module right away, LazyWrapper lazy is called
      factory()
        // wait for the JS module to be resolved
        .then(({ default: Component }) =&gt; {
          ref.current = Component;

          rerender();
        })
        .catch((e) =&gt; {
          // handle error
        });
    }, []);

    const Component = ref.current;
    return &lt;Component {...props} /&gt;;
  };
};</code></span></div><p style="line-height:1.4;font-size:1.125rem;color:#1a1a1a">By importing </p><div><div><button>Load</button></div><div></div></div></article></main></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/suspense","query":{},"buildId":"uvQ_SCDlWddJhnxJtBvs3","assetPrefix":"/advanced-react-pattern","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>